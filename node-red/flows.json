[{"id":"4fb16ea1.f8c3f","type":"tab","label":"PostgreSQL","disabled":false,"info":""},{"id":"4cf958e0.30c348","type":"tab","label":"influxdb","disabled":false,"info":""},{"id":"95a6a803.b977b8","type":"tab","label":"end point","disabled":false,"info":""},{"id":"f4699060.708ff","type":"tab","label":"Prototype","disabled":false,"info":""},{"id":"8c865d1a.468b8","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"27661a71.71c566","type":"tab","label":"Plot peak","disabled":false,"info":""},{"id":"f4a5a432.977d58","type":"tab","label":"Browse OPC","disabled":false,"info":""},{"id":"a5c752b4.9a948","type":"subflow","name":"MQTT equipment","info":"","category":"FAST Equipment","in":[{"x":320,"y":140,"wires":[{"id":"e04368df.4aa588"}]}],"out":[{"x":1280,"y":140,"wires":[{"id":"b31c5dfd.836b8","port":0}]}],"env":[]},{"id":"22d174df.74346c","type":"subflow","name":"balance","info":"","category":"lab equipment","in":[{"x":50,"y":30,"wires":[]}],"out":[{"x":160,"y":30,"wires":[]}],"env":[]},{"id":"d221c175.b6feb","type":"subflow","name":"pump","info":"","category":"FAST Equipment","in":[{"x":50,"y":30,"wires":[]}],"out":[{"x":160,"y":30,"wires":[]}],"env":[]},{"id":"61547feb.61fe8","type":"subflow","name":"stir","info":"","category":"FAST Equipment","in":[{"x":50,"y":30,"wires":[]}],"out":[{"x":160,"y":30,"wires":[]}],"env":[]},{"id":"9b099651.5e2a48","type":"subflow","name":"FAST input","info":"","category":"FAST Equipment","in":[],"out":[],"env":[]},{"id":"11b9850d.964dfb","type":"postgresdb","z":"","hostname":"postgres","port":"5432","db":"mydatabase","ssl":false},{"id":"2e033692.9a2b6a","type":"influxdb","z":"","hostname":"influxdb","port":"8086","protocol":"http","database":"mydatabase","name":"","usetls":false,"tls":""},{"id":"8d06d29f.4b582","type":"ui_tab","z":"","name":"Prototype playground","icon":"dashboard","disabled":false,"hidden":false},{"id":"f81996f0.99aee8","type":"ui_group","z":"","name":"MT Balance","tab":"8d06d29f.4b582","disp":true,"width":"6","collapse":false},{"id":"e226105f.02144","type":"mqtt-broker","z":"","name":"xeon","broker":"10.131.72.83","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"b3acf60b.ca0db8","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"ba6631.51bd49d","type":"OpcUa-Endpoint","z":"","endpoint":"opc.tcp://10.131.1.35:62552/iCOpcUaServer","secpol":"None","secmode":"NONE","login":false},{"id":"f3d240ee.f5991","type":"ui_group","z":"","name":"Default","tab":"ee9aeec7.d445f","order":2,"disp":true,"width":"12","collapse":false},{"id":"fca89040.aa06c","type":"ui_group","z":"","name":"Default","tab":"ee9aeec7.d445f","order":1,"disp":true,"width":"12","collapse":false},{"id":"71d34856.677478","type":"OpcUa-Endpoint","z":"","endpoint":"opc.tcp://10.131.1.35:62552/iCOpcUaServer","secpol":"None","secmode":"NONE","login":false},{"id":"ee9aeec7.d445f","type":"ui_tab","z":"","name":"Home","icon":"dashboard","disabled":false,"hidden":false},{"id":"f3e2873c.7a8fe8","type":"inject","z":"4fb16ea1.f8c3f","name":"data trigger","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":true,"onceDelay":"","x":290,"y":360,"wires":[["13de878b.7c8a78"]]},{"id":"4ee9515a.155ba","type":"function","z":"4fb16ea1.f8c3f","name":"prepare query","func":"msg.payload = [\n    {\n        query: 'begin',\n    },\n    {\n        query: 'insert into mytable (timestamp, username, experiment, value) values ($1, $2, $3, $4)',\n        params: [msg.payload[\"timestamp\"], msg.payload[\"username\"], msg.payload[\"experiment\"], msg.payload[\"value\"]],\n    },\n    {\n        query: 'select * from mytable',\n        output: true,\n    },\n    {\n        query: 'commit',\n    },\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":380,"wires":[[]]},{"id":"1ca80544.2a735b","type":"postgres","z":"4fb16ea1.f8c3f","postgresdb":"11b9850d.964dfb","name":"mydatabase","output":true,"outputs":1,"x":970,"y":380,"wires":[[]]},{"id":"13de878b.7c8a78","type":"function","z":"4fb16ea1.f8c3f","name":"create data point","func":"msg.payload = {\n    \"timestamp\": Math.floor(Date.now()/1000),\n    \"username\": \"Brent Maranzano\",\n    \"experiment\": \"test\",\n    \"value\": Math.floor(Math.random()*1000+10000)\n};\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":380,"wires":[["4ee9515a.155ba"]]},{"id":"7acb2cc5.6afbf4","type":"inject","z":"4cf958e0.30c348","name":"data trigger","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":true,"onceDelay":"","x":290,"y":180,"wires":[["f8f8058c.52d878"]]},{"id":"f8f8058c.52d878","type":"function","z":"4cf958e0.30c348","name":"create data","func":"msg.payload = {\n    \"username\": \"Brent Maranzano\",\n    \"experiment\": \"test\",\n    \"value\": Math.floor(Math.random()*1000+10000)\n};\nreturn msg;","outputs":1,"noerr":0,"x":590,"y":180,"wires":[["12a52452.a273bc"]]},{"id":"12a52452.a273bc","type":"influxdb out","z":"4cf958e0.30c348","influxdb":"2e033692.9a2b6a","name":"mydatabase","measurement":"random","precision":"","retentionPolicy":"","x":910,"y":180,"wires":[]},{"id":"47c8991.8c18368","type":"http response","z":"95a6a803.b977b8","name":"http response","statusCode":"","headers":{},"x":880,"y":300,"wires":[]},{"id":"d35e4032.a434c","type":"function","z":"95a6a803.b977b8","name":"html response","func":"msg.payload = \"hello world from node-red\";\nreturn msg;","outputs":1,"noerr":0,"x":620,"y":300,"wires":[["47c8991.8c18368","bd2a36a4.5621c8"]]},{"id":"9a2d508.16af9b","type":"http in","z":"95a6a803.b977b8","name":"node-red endpoint","url":"/ndr/test","method":"get","upload":false,"swaggerDoc":"","x":410,"y":300,"wires":[["d35e4032.a434c","bd2a36a4.5621c8"]]},{"id":"b6929565.a45d18","type":"mqtt out","z":"a5c752b4.9a948","name":"send command","topic":"","qos":"","retain":"","broker":"e226105f.02144","x":700,"y":140,"wires":[]},{"id":"e04368df.4aa588","type":"function","z":"a5c752b4.9a948","name":"format mqtt","func":"flow.set(\"topic\", msg.topic);\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":140,"wires":[["b6929565.a45d18"]]},{"id":"acc01807.f2cac8","type":"mqtt in","z":"a5c752b4.9a948","name":"command response","topic":"res/balance/#","qos":"2","datatype":"auto","broker":"e226105f.02144","x":890,"y":140,"wires":[["b31c5dfd.836b8"]]},{"id":"b31c5dfd.836b8","type":"function","z":"a5c752b4.9a948","name":"select topic","func":"var command = flow.get(\"topic\").split(\"/\").slice(1).join(\"/\");\nvar response = msg.topic;\n\nif (response.split(\"/\")[0] === \"res\" &&\n    response.split(\"/\").slice(1).join(\"/\") === command) {\n        msg.payload = msg.payload;\n        return msg;\n}","outputs":1,"noerr":0,"x":1130,"y":140,"wires":[[]]},{"id":"728bb030.cff7b","type":"inject","z":"f4699060.708ff","name":"get weight","topic":"get/balance/1/weight/PV","payload":"null","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":360,"y":300,"wires":[["1252987c.256f38"]]},{"id":"8890e61a.5031c8","type":"debug","z":"f4699060.708ff","name":"debug","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":750,"y":300,"wires":[]},{"id":"1252987c.256f38","type":"subflow:a5c752b4.9a948","z":"f4699060.708ff","name":"","x":550,"y":300,"wires":[["8890e61a.5031c8"]]},{"id":"bd2a36a4.5621c8","type":"debug","z":"95a6a803.b977b8","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":760,"y":380,"wires":[]},{"id":"6d84ecd0.52ac04","type":"subflow:d221c175.b6feb","z":"8c865d1a.468b8","name":"","x":260,"y":460,"wires":[[]]},{"id":"37fa5cf1.b9e7e4","type":"subflow:61547feb.61fe8","z":"8c865d1a.468b8","name":"","x":660,"y":580,"wires":[[]]},{"id":"be837b81.73d038","type":"function","z":"8c865d1a.468b8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":150,"y":580,"wires":[["6d84ecd0.52ac04"]]},{"id":"8df46fbe.a8a0e","type":"OpcUa-Client","z":"27661a71.71c566","endpoint":"ba6631.51bd49d","action":"read","deadbandtype":"a","deadbandvalue":1,"time":10,"timeUnit":"s","certificate":"n","localfile":"","name":"","x":580,"y":340,"wires":[["d4e9fec3.0babc"]]},{"id":"7a4636ad.a3c1a8","type":"inject","z":"27661a71.71c566","name":"","topic":"ns=2;s=Local.iCIR.Probe1.SpectraRaw","payload":"","payloadType":"str","repeat":"10","crontab":"","once":true,"onceDelay":0.1,"x":270,"y":340,"wires":[["8df46fbe.a8a0e"]]},{"id":"cfdfd871.0c1568","type":"debug","z":"27661a71.71c566","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1020,"y":340,"wires":[]},{"id":"d4e9fec3.0babc","type":"function","z":"27661a71.71c566","name":"extract point","func":"msg.payload = msg.payload[10];\nreturn msg;","outputs":1,"noerr":0,"x":790,"y":240,"wires":[["d9bde385.3dd35"]]},{"id":"d9bde385.3dd35","type":"ui_chart","z":"27661a71.71c566","name":"peak","group":"f3d240ee.f5991","order":1,"width":0,"height":0,"label":"chart","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":980,"y":240,"wires":[[]]},{"id":"97af6412.356ac8","type":"ui_template","z":"f4a5a432.977d58","group":"fca89040.aa06c","name":"Browse","order":0,"width":"12","height":"11","format":"<div layout=\"row\" layout-align=\"space-between\">\n    <select ng-model=\"item\" ng-options=\"items.item.displayName.text for items in msg.payload\">\n        <option value=\"\">-- Objects Root --</option>\n    </select>\n    <button ng-click=\"send({payload: {actiontype: 'browse', root: item}})\">\n        Browse\n    </button>\n</div>\n<div layout=\"row\" layout-align=\"space-between\">\n    <ul>\n        <li ng-repeat=\"items in msg.payload\">\n          {{items.item.displayName.text}}: {{items.item.nodeId}}\n        </li>\n    </ul>\n</div>\n","storeOutMessages":true,"fwdInMessages":false,"templateScope":"local","x":500,"y":180,"wires":[["9c953dcb.a482"]]},{"id":"9c953dcb.a482","type":"OpcUa-Browser","z":"f4a5a432.977d58","endpoint":"71d34856.677478","item":"","datatype":"","topic":"","items":[],"x":500.40003967285156,"y":285.6000061035156,"wires":[["97af6412.356ac8"]]},{"id":"539bf732.f98988","type":"inject","z":"27661a71.71c566","name":"","topic":"","payload":"[]","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":770,"y":180,"wires":[["d9bde385.3dd35"]]},{"id":"15443538.37f2fb","type":"OpcUa-Browser","z":"f4a5a432.977d58","endpoint":"71d34856.677478","item":"","datatype":"","topic":"ns=0;i=85","items":[],"x":410,"y":420,"wires":[["1b260f54.1ce6f1"]]},{"id":"1b260f54.1ce6f1","type":"debug","z":"f4a5a432.977d58","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":620,"y":480,"wires":[]},{"id":"a0ab943a.fc9e18","type":"inject","z":"f4a5a432.977d58","name":"","topic":"ns=0;i=2253","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":200,"y":460,"wires":[[]]}]